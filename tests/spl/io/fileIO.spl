include "../array/int_array.spl";

//var O_CREAT := 1;
//var O_APPEND := 2;

procedure open(pathname: Array<Int>, flags: Int) returns (fd: Int)
    requires array(pathname)
    //requires string(pathname)
    requires flags == 0 // || flags == O_CREAT || flags == O_APPEND
    ensures array(pathname)
    //ensures string(pathname)
    ensures pathname == old(pathname)
    ensures pathname.length == old(pathname.length)
    ensures forall i: Int :: i >= 0 && i <= pathname.length ==> pathname[i] == old(pathname[i])
    ensures fd >= -1

procedure read(fd: Int, buffer: Array<Int>) returns (nbr: Int)
    requires fd >= 0
    requires array(buffer)
    //requires byte_array(buffer)
    ensures array(buffer)
    //ensures byte_array(buffer)
    ensures buffer == old(buffer)
    ensures buffer.length == old(buffer.length)
    ensures nbr >= -1 && nbr <= buffer.length

procedure write(fd: Int, buffer: Array<Int>) returns (nbr: Int)
    requires fd >= 0
    requires array(buffer)
    //requires byte_array(buffer)
    ensures array(buffer)
    //ensures byte_array(buffer)
    ensures buffer == old(buffer)
    ensures buffer.length == old(buffer.length)
    ensures forall i: Int :: i >= 0 && i <= buffer.length ==> buffer[i] == old(buffer[i])
    ensures nbr >= -1 && nbr <= buffer.length

procedure close(fd: Int)
    requires fd >= 0
